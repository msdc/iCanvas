/*@author Mingli Guo (guomilo@gmail.com)
 * @Date 2014-03-12 
 */
define("src/lib/core",["../tools/util","../tools/observer","../tools/easing"],function(a){function b(a,g){function h(a){return c.isString(a)&&a in e||(a="linear"),c.bind(e[a],e)}function i(a){_animateState=a}function j(){var a,b,d=Date.now(),e=p,g={};if(v&&this.getStates()!=f.STOP&&(a=e-n,d-q>=m())){if(e>=n){for(b in x)startValue=w[b]||0,endValue=Number(x[b]),c.isNumber(endValue)||(endValue=startValue),g[b]=t(n,startValue,endValue-startValue,e);n++,i(f.RUNNING),u.notifyByKey("frame",g)}else v=!1,n=0,i(f.COMPLETED),u.notifyByKey("completed");q=Date.now()}}var k=a||1e3,l=g||20,m=function(){return 1e3/l},n=0,o=function(){return parseInt((k/m()).toFixed(0),10)},p=o(),q=0,r=0,s=0,t=h("linear"),u=new d(this),v=!1,w={},x={},y=0;_animateState=f.READY,this._guid=c.newId(),this.getStates=function(){return _animateState},this.start=function(){v=!0;var a=this.getStates();a!=f.PAUSE&&(r=Date.now()),a==f.PAUSE&&(r+=Date.now()-y),i(f.START)},this.stop=function(){v=!1,p>=n&&(i(f.PAUSE),y=Date.now())},this.setDuration=function(a){return k=a,p=o(),this},this.setDuration=function(a){return l=a,p=o(),this},this.from=function(a){return w=a,this},this.to=function(a){return x=a,this},this.easing=function(a){return t=h(a),this},this.delay=function(a){s=a},this.onframe=function(a){c.isFunction(a)&&u.attach("frame",a)},this.oncompleted=function(a){c.isFunction(a)&&u.attach("completed",a)},this.clone=function(){var a=new b;return a.setDuration(k).from(w).to(x).delay(s).easing(t),a},this.frame=function(){Date.now()-r<s||j.apply(this)}}var c=a("../tools/util"),d=a("../tools/observer"),e=a("../tools/easing");!1 in Date&&(Date.now=function(){return(new Date).getTime()});var f={READY:"1",START:"2",RUNNING:"3",PAUSE:"4",COMPLETED:"5"};return b});